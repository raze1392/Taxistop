!function(e){function a(e){return e.toLowerCase()}e.chanakya=e.chanakya||{},e.mobilecheck=function(){var a=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||e.opera),a},e.androidAppCheck=function(){var a=!1;return function(){/TaxiStopApp\/[0-9\.]+$/.test(navigator.userAgent)&&(a=!0)}(navigator.userAgent||navigator.vendor||e.opera),a};var t=angular.module("chanakyaApp",["ngSanitize"]);t.controller("ChanakyaCtrl",["$scope","$http","$interval",function(t,i){function n(){t.cabs.selected="",t.cabs.estimate=[],t.cabs.coordinates={},t.availableTypes=0,c(t.cabs.coordinates,t.cabs.selected)}function s(e,a,i){if(i){if(!a.cabsEstimate)return;console.log(e,a),t.cabs.selected="all";for(var n=0;n<a.cabsEstimate.length;n++)a.cabsEstimate[n].type=e,a.cabsEstimate[n].available&&t.availableTypes++;t.cabs.estimate=t.cabs.estimate.concat(a.cabsEstimate);for(var s in a.cabs)t.cabs.coordinates[s]=a.cabs[s];return void c(t.cabs.coordinates,t.cabs.selected)}if(!a.cabsEstimate)return void(t.mask=!0);t.mask=!1,t.availableTypes=0;for(var r=0;r<a.cabsEstimate.length;r++)a.cabsEstimate[r].type=e,a.cabsEstimate[r].available&&t.availableTypes++;t.cabs.selected=e,t.cabs.estimate=a.cabsEstimate,t.cabs.coordinates=a.cabs,c(t.cabs.coordinates,t.cabs.selected),o(43*t.availableTypes)}function o(a){r.style.height=0===t.availableTypes?t.mapHeight-25+"px":t.mapHeight-a+"px",google.maps.event.trigger(e.chanakya.Map.getMap(),"resize"),e.chanakya.Map.existsSource()&&e.chanakya.Map.existsDestination()||e.chanakya.Map.getMap().setCenter(e.chanakya.Map.getSource().location)}function c(a,t){e.chanakya.Map.clearMarkers("cabs");for(var i in a)for(var n=(a[i],0);2>n;n++){var s=a[i][n];if(s){var o=e.chanakya.Map.convertLatLngToLocation(s.lat,s.lng);e.chanakya.Map.setMarker(o,t.toUpperCase()+" "+i,u[i])}}}t.source={lat:void 0,lng:void 0},t.cabs={selected:"tfs"};var r=document.getElementById("map-canvas"),l=document.getElementById("searchSource"),p=document.getElementById("searchDestination"),u={Mini:"http://akush.github.io/taxistop/images/mini.png",Hatchback:"http://akush.github.io/taxistop/images/mini.png",Genie:"http://akush.github.io/taxistop/images/mini.png",Nano:"http://akush.github.io/taxistop/images/mini.png",Sedan:"http://akush.github.io/taxistop/images/sedan.png",Meru:"http://akush.github.io/taxistop/images/sedan.png",Prime:"http://akush.github.io/taxistop/images/prime.png",Pink:"http://akush.github.io/taxistop/images/prime.png",Auto:"http://akush.github.io/taxistop/images/auto.png","Kaali Peeli":"http://akush.github.io/taxistop/images/mini.png",uberX:"http://akush.github.io/taxistop/images/mini.png",UberBLACK:"http://akush.github.io/taxistop/images/sedan.png"};t.services=[{name:"Ola",icon:"http://akush.github.io/taxistop/images/ola-icon-50x50.png"},{name:"Uber",icon:"http://akush.github.io/taxistop/images/uber-icon-50x50.png"},{name:"TFS",icon:"http://akush.github.io/taxistop/images/tfs-icon-50x50.jpg"},{name:"Meru",icon:"http://akush.github.io/taxistop/images/meru-icon-50x50.jpg"}],t.mask=!1,t.availableTypes=0,t.showMask=function(){return t.isMobile?0!==t.availableTypes:t.cabs.estimate&&t.cabs.estimate.length>0},t.getOla=function(e){i.get("cabs/ola?lat="+t.source.lat+"&lng="+t.source.lng).success(function(a){s("ola",a,e)})},t.getUber=function(e){i.get("cabs/uber?lat="+t.source.lat+"&lng="+t.source.lng).success(function(a){s("uber",a,e)})},t.getTfs=function(e){i.get("cabs/tfs?lat="+t.source.lat+"&lng="+t.source.lng).success(function(a){s("tfs",a,e)})},t.getMeru=function(e){i.get("cabs/meru?lat="+t.source.lat+"&lng="+t.source.lng).success(function(a){s("meru",a,e)})},t.getService=function(e){n(),t.cabs.selected=e,"all"===a(e)?(t.getOla(!0),t.getUber(!0),t.getTfs(!0),t.getMeru(!0)):"ola"==a(e)?t.getOla():"uber"==a(e)?t.getUber():"tfs"==a(e)?t.getTfs():"meru"==a(e)&&t.getMeru()},t.getCabImg=function(e){return u[e]},t.getCabTypeImg=function(e){return"ola"==a(e)?t.services[0].icon:"uber"==a(e)?t.services[1].icon:"tfs"==a(e)?t.services[2].icon:"meru"==a(e)?t.services[3].icon:void 0},t.travelTime=0,t.travelDistance=0,t.travelInfoLoadFailed=!1,t.setTravelInfo=function(){if(t.destination&&t.destination.lat){var e="eta?srcLat="+t.source.lat+"&srcLng="+t.source.lng;e+="&destLat="+t.destination.lat+"&destLng="+t.destination.lng,i.get(e).success(function(e){e.success?(t.travelInfoLoadFailed=!1,t.travelTime=Math.ceil(e.duration.value/60),t.travelDistance=e.distance.value/1e3):t.travelInfoLoadFailed=!0})}},t.getTravelTime=function(a){if(!e.chanakya.Map.existsDestination()||!a.available)return"";if(t.travelInfoLoadFailed)return"failed";if(0===t.travelTime)return"wait";var i=a.duration+t.travelTime;return Math.floor(i)+" mins"},t.getArrivalTime=function(e){return e.available?"Arrives in "+Math.floor(e.duration)+" mins":"Not available"},t.uberCost={uberX:"",UberBLACK:"",multipliers:{uberX:1,UberBLACK:1}},t.getTravelCost=function(i){if(!e.chanakya.Map.existsDestination()||!i.available)return"";if(0===t.travelDistance)return"calculating";if("ola"==a(i.type))return t.travelInfoLoadFailed?"failed":"apx &#8377;"+Math.ceil(e.chanakya.cost.ola(t.travelDistance,i.name.toLowerCase()));if("tfs"==a(i.type))return t.travelInfoLoadFailed?"failed":"apx &#8377;"+Math.ceil(e.chanakya.cost.tfs(t.travelDistance,i.name.toLowerCase()));if("uber"==a(i.type)){if(""===t.uberCost[i.name])return"calculating";var n="";return 1!=t.uberCost.multipliers[i.name]&&(n="<span class='multiplier'>"+t.uberCost.multipliers[i.name]+"x</span>"),n+" &#8377;"+t.uberCost[i.name]}},t.getUberCost=function(){i.get("cabs/uber/cost?srcLat="+t.source.lat+"&srcLng="+t.source.lng+"&destLat="+t.destination.lat+"&destLng="+t.destination.lng).success(function(e){for(var a in e.prices)t.uberCost[e.prices[a].name]=e.prices[a].low_estimate==e.prices[a].high_estimate?e.prices[a].low_estimate:e.prices[a].low_estimate+"-"+e.prices[a].high_estimate,t.uberCost.multipliers[e.prices[a].name]=e.prices[a].multiplier})},t.showFilter=function(e){return t.isMobile&&!e.available?!1:!0},t.typingOn=!1,t.isShownDetails=function(){return t.isMobile?!t.typingOn:!0},t.clearDestination=function(){t.destination=void 0,e.chanakya.Map.Directions.clearDirections()},t.openApp=function(e){t.isAndroidApp&&Android.openApp(e)},t.init=function(){t.isMobile=e.mobilecheck(),t.isAndroidApp=e.androidAppCheck(),t.isMobile&&!t.isAndroidApp?(t.mapHeight=document.body.clientHeight-148,r.style.height=t.mapHeight+"px"):t.isMobile&&t.isAndroidApp&&(t.mapHeight=screen.height-148,r.style.height=t.mapHeight+"px")},t.callAtInterval=function(){t.getService(t.cabs.selected),t.destination&&t.destination.lat&&(t.setTravelInfo(),t.getUberCost())},google.maps.event.addDomListener(e,"load",function(){if(e.androidAppCheck()){console.log(Android.getUserLocation());var a=Android.getUserLocation().split("|");e.chanakya.Map.intializeGmaps(r,l,p,{latitude:a[0],longitude:a[1]},function(){e.chanakya.Map.Search.initializeAutocompleteSourceBox(l),e.chanakya.Map.Search.initializeAutocompleteDestinationBox(p)})}else e.chanakya.Map.intializeGmapsUsingNavigator(r,l,p,function(){e.chanakya.Map.Search.initializeAutocompleteSourceBox(l),e.chanakya.Map.Search.initializeAutocompleteDestinationBox(p)})}),l.addEventListener("sourceLocationChanged",function(e){t.source={lat:e.detail.lat,lng:e.detail.lng},t.getService(t.cabs.selected),t.typingOn=!1},!1),p.addEventListener("destinationLocationChanged",function(e){t.destination={lat:e.detail.lat,lng:e.detail.lng},t.uberCost={uberX:"",UberBLACK:"",multipliers:{uberX:1,UberBLACK:1}},t.setTravelInfo(),t.getUberCost(),t.typingOn=!1},!1),t.init()}])}(window,angular);